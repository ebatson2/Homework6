[
  {
    "objectID": "Homework6.html",
    "href": "Homework6.html",
    "title": "Homework6",
    "section": "",
    "text": "Task 1: Conceptual Questions\n\nWhat is the purpose of the lapply() function? What is the equivalent purrr function?\nlapply() is used to apply a function accross the rows or columns of an input, where the input data is in the form of a list. The output is also in a list. The equivalent purrr function is map().\nSuppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = “kendall”) on each element of the list. Write code to do this below! (I’m really trying to ask you how you specify method = “kendall” when calling lapply())\nlapply(X=my_list, FUN=cor, method=“kendall”)\nWhat are two advantages of using purrr functions instead of the BaseR apply family?\npurrr functions are more consistent syntax-wise, such as with their function names and function inputs. Function inputs can also be made more concise by using anonymous functions.\nWhat is a side-effect function?\nA side-effect function does not mutate the data in the program, but accomplishes some other task, e.g. writing to file.\nWhy can you name a variable sd in a function and not cause any issues with the sd function?\nBecause the scope of the sd variable in the function is the function itself. The temporary environment created while the function is running is cleaned up after the function runs, so the sd variable defined within the function no longer exists.\n\n\n\nTask 2: Writing R Functions\nBasic function that takes in a vector of responses and a vector of predictions and outputs the RMSE:\n\ngetRMSE &lt;- function(resp, pred, ...){\n  return ((mean(..., (resp-pred)**2))**(1/2))\n}\n\nCreate response values and predictions and test RMSE function:\n\n# generate data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n# test RMSE function\ngetRMSE(resp, pred)\n\n[1] 0.9581677\n\n# insert NA values into resp\nresp &lt;- replace(resp, c(50, 75), NA_real_)\n\n# use function with and without NA handling\ngetRMSE(resp, pred)\n\n[1] NA\n\ngetRMSE(resp, pred, na.rm = TRUE)\n\n[1] 0.9593123\n\n\nFunction that takes in a vector of responses and a vector of predictions and outputs the MAE:\n\ngetMAE &lt;- function(resp, pred, ...){\n  return (mean(..., abs(resp-pred)));\n}\n\nCreate response values and predictions and test MAE function:\n\n# generate data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n# test MAE function\ngetMAE(resp, pred)\n\n[1] 0.8155776\n\n# insert NA values into resp\nresp &lt;- replace(resp, c(50, 75), NA_real_)\n\n# use function with and without NA handling\ngetMAE(resp, pred)\n\n[1] NA\n\ngetMAE(resp, pred, na.rm = TRUE)\n\n[1] 0.814056\n\n\nWrapper function to call getRMSE and getMAE:\n\nmetrics_options &lt;- c(\"both\", \"RMSE\", \"MAE\")\n\ncalc_error &lt;- function(resp, pred, metrics=\"both\", ...){\n  \n  # ---------------------input validation---------------------\n  if(!(is.vector(resp) && is.atomic(resp) && is.numeric(resp))) {\n    cat(\"Response vector must be an atomic vector with numeric values.\")\n    return()\n  }\n  if(!(is.vector(pred) && is.atomic(pred) && is.numeric(pred))) {\n    cat(\"Prediction vector must be an atomic vector with numeric values.\")\n    return()\n  }\n  \n  if(!(metrics %in% metrics_options)) {\n    cat(\"metrics must take one of the following character string values: both, RMSE, MAE\")\n    return()\n  }\n  # ---------------------input validation---------------------\n\n  switch (metrics,\n    both = {\n      RMSE &lt;- getRMSE(resp, pred, ...)\n      MAE &lt;- getMAE(resp, pred, ...)\n      \n      return(list(RMSE=RMSE, MAE=MAE))\n    },\n    \n    RMSE = {\n      RMSE &lt;- getRMSE(resp, pred, ...)\n\n      return(list(RMSE=RMSE))\n    },\n    \n    MAE = {\n      MAE &lt;- getMAE(resp, pred, ...)\n\n      return(list(MAE=MAE))\n    }\n  )\n}\n\nCreate response values and predictions and test calc_error function:\n\n# generate data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n# test calc_error function\ncalc_error(resp, pred, metrics=\"RMSE\")\n\n$RMSE\n[1] 0.9581677\n\ncalc_error(resp, pred, metrics=\"MAE\")\n\n$MAE\n[1] 0.8155776\n\ncalc_error(resp, pred, metrics=\"both\")\n\n$RMSE\n[1] 0.9581677\n\n$MAE\n[1] 0.8155776\n\n# insert NA values into resp\nresp &lt;- replace(resp, c(50, 75), NA_real_)\n\n# use function with and without NA handling\ncalc_error(resp, pred)\n\n$RMSE\n[1] NA\n\n$MAE\n[1] NA\n\ncalc_error(resp, pred, na.rm = TRUE)\n\n$RMSE\n[1] 0.9593123\n\n$MAE\n[1] 0.814056\n\n# pass incorrect data\npred_incorrect &lt;- replace(pred, c(40), \"word\")\nno_output &lt;- calc_error(resp, pred_incorrect)\n\nPrediction vector must be an atomic vector with numeric values.\n\n\n\n\nTask 3: Querying an API and a Tidy-Style Function\nLoad libraries:\n\nlibrary(httr)\nlibrary(purrr)\nlibrary(dplyr)\nlibrary(lubridate)\n\nFetch data from API and parse, grab first articles element:\n\napi_key=\"e3fc7755a72448f4b66440378abad7b6\"\n\nresponse &lt;- GET(paste0(\"https://newsapi.org/v2/everything?q=election&from=2024-10-20&sortBy=publishedAt&apiKey=\", api_key))\ndata &lt;- content(response)\n\n# access 1st articles element\npluck(data$articles, 1)\n\n$source\n$source$id\nNULL\n\n$source$name\n[1] \"[Removed]\"\n\n\n$author\nNULL\n\n$title\n[1] \"[Removed]\"\n\n$description\n[1] \"[Removed]\"\n\n$url\n[1] \"https://removed.com\"\n\n$urlToImage\nNULL\n\n$publishedAt\n[1] \"2024-10-27T15:05:44Z\"\n\n$content\n[1] \"[Removed]\"\n\n# first column: source info\npluck(data$articles, 1)[1]\n\n$source\n$source$id\nNULL\n\n$source$name\n[1] \"[Removed]\"\n\n\nFunction to query API:\n\nquery_api &lt;- function(subject, start_date, api_key){\n\n  response &lt;- GET(paste0(\"https://newsapi.org/v2/everything?q=\", \n                         subject,\n                         \"&from=\",\n                         start_date,\n                         \"6&sortBy=publishedAt&apiKey=\", \n                         api_key))\n  \n  return(content(response)$articles)\n}\n\nExecute and save 2 fetches:\n\nelection_data &lt;- query_api(subject=\"election\", start_date=\"2024-09-26\", api_key=\"e3fc7755a72448f4b66440378abad7b6\")\nhurricane_data &lt;- query_api(subject=\"hurricane\", start_date=\"2024-09-26\", api_key=\"e3fc7755a72448f4b66440378abad7b6\")\n\nFunction to create a usable tibble from api data:\n\ncreate_tibble &lt;- function(api_data){\n  \n  # get the names of all the columns\n  col_names &lt;- names(api_data[[1]][-1])\n\n  # destructure source columns info first\n  sourceName &lt;- map(api_data, pluck, \"source\", \"name\")\n  sourceName[sapply(sourceName, is.null)] &lt;- NA\n  sourceName &lt;- unlist(sourceName)\n  \n  sourceId &lt;- map(api_data, pluck, \"source\", \"id\")\n  sourceId[sapply(sourceId, is.null)] &lt;- NA\n  sourceId &lt;- unlist(sourceId)\n  \n  # initialize tibble\n  return_tibble &lt;- tibble(sourceName=sourceName, sourceId=sourceId)\n  \n  # clean up data for the rest of the columns\n  for (col in col_names){\n    col_data &lt;- map(api_data, pluck, col)\n    col_data[sapply(col_data, is.null)] &lt;- NA\n    col_data &lt;- unlist(col_data)\n    return_tibble &lt;- mutate(return_tibble, !!(col) := col_data)\n  }\n  \n  return(return_tibble)\n}\n\nGet tibbles for election and hurricane data:\n\nelection_tibble &lt;- create_tibble(election_data)\nelection_tibble\n\n# A tibble: 100 × 9\n   sourceName     sourceId author title description url   urlToImage publishedAt\n   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;      \n 1 [Removed]      &lt;NA&gt;     &lt;NA&gt;   [Rem… \"[Removed]\" http… &lt;NA&gt;       2024-10-27…\n 2 HuffPost       &lt;NA&gt;     Igor … JD V… \"The Repub… http… https://i… 2024-10-27…\n 3 [Removed]      &lt;NA&gt;     &lt;NA&gt;   [Rem… \"[Removed]\" http… &lt;NA&gt;       2024-10-27…\n 4 Digital Journ… &lt;NA&gt;     AFP    Ex-p… \"Former Bo… http… https://w… 2024-10-27…\n 5 International… &lt;NA&gt;     AFP N… Ex-p… \"Former Bo… http… https://d… 2024-10-27…\n 6 ABC News       abc-news KATE … Geor… \"The Democ… http… https://i… 2024-10-27…\n 7 Wonkette.com   &lt;NA&gt;     Andre… Brit… \"When the … http… https://s… 2024-10-27…\n 8 Yahoo Enterta… &lt;NA&gt;     Daria… Trum… \"Retirees … http… https://s… 2024-10-27…\n 9 Biztoc.com     &lt;NA&gt;     newsw… How … \"As Electi… http… https://b… 2024-10-27…\n10 Newser         &lt;NA&gt;     Bob C… Elec… \"Georgia's… http… https://i… 2024-10-27…\n# ℹ 90 more rows\n# ℹ 1 more variable: content &lt;chr&gt;\n\nhurricane_tibble &lt;- create_tibble(hurricane_data)\nhurricane_tibble\n\n# A tibble: 100 × 9\n   sourceName     sourceId author title description url   urlToImage publishedAt\n   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;      \n 1 The Portland … &lt;NA&gt;     Wm. S… \"YOU… \"by Wm. St… http… https://m… 2024-10-27…\n 2 Slashdot.org   &lt;NA&gt;     feedf… \"Tro… \"Tropical … http… &lt;NA&gt;       2024-10-27…\n 3 Noaa.gov       &lt;NA&gt;     nhcwe… \"Pos… \"5-Day Unc… http… &lt;NA&gt;       2024-10-27…\n 4 BroBible       &lt;NA&gt;     Grays… \"Col… \"UTSA comp… http… https://b… 2024-10-27…\n 5 gcaptain.com   &lt;NA&gt;     John … \"Ame… \"by John K… http… https://g… 2024-10-27…\n 6 Billboard      &lt;NA&gt;     Melin… \"Luk… \"Here are … http… https://w… 2024-10-27…\n 7 Econlib.org    &lt;NA&gt;     David… \"My … \"With SCOT… http… https://w… 2024-10-27…\n 8 Bleacher Repo… bleache… Scott… \"Car… \"Carolina … http… https://m… 2024-10-27…\n 9 Common Dreams  &lt;NA&gt;     Ben G… \"Hur… \"It’s 2029… http… https://w… 2024-10-27…\n10 Blogger.com    &lt;NA&gt;     Calcu… \"CES…  &lt;NA&gt;       http… &lt;NA&gt;       2024-10-27…\n# ℹ 90 more rows\n# ℹ 1 more variable: content &lt;chr&gt;\n\n\n1-way contingency table for source name (election data):\n\ntable(election_tibble$sourceName)\n\n\n                   [Removed]                     ABC News \n                          22                            3 \n               Aljazeera.net                     BBC News \n                           1                            1 \n                  Biztoc.com               Breitbart News \n                           9                            2 \n                    CBS News                         CNBC \n                           1                            1 \n               Common Dreams              Digital Journal \n                           1                            1 \n  Fairbanks Daily News-Miner                       Forbes \n                           1                            3 \n                     Fortune                     Fox News \n                           1                            3 \n            Freerepublic.com               Hatenablog.com \n                           8                            1 \n                    HuffPost International Business Times \n                           2                            2 \n               Investing.com                   Just Jared \n                           1                            1 \n    Lawyersgunsmoneyblog.com           Liveandletsfly.com \n                           1                            1 \n                    Mediaite              Memeorandum.com \n                           1                            1 \n                    NBC News                New York Post \n                           1                            2 \n                      Newser                     Newsweek \n                           1                            1 \n              Planetizen.com             Psychology Today \n                           1                            1 \n                   Raw Story                Rolling Stone \n                           2                            1 \n         Securityaffairs.com                      Sky.com \n                           1                            1 \n                Slashdot.org              Steynonline.com \n                           3                            2 \n          The Jerusalem Post       The National Interest  \n                           2                            1 \n        The Portland Mercury           The Times of India \n                           1                            2 \n                 Tistory.com         Vantagedatahouse.com \n                           1                            1 \n                Wonkette.com                Wordpress.com \n                           1                            1 \n         Yahoo Entertainment \n                           4 \n\n\nFunction for reformatting the publishedAt column and adding the pub_diff column:\n\nhandle_publishedAt &lt;- function(tb){\n  \n  tb &lt;- tb |&gt;\n    mutate(publishedAt=ymd_hms(publishedAt)) |&gt;\n    arrange(publishedAt) |&gt;\n    mutate(pub_diff=(publishedAt - lag(publishedAt)))\n  \n  return(tb)\n}\n\nUse function on both tibbles:\n\nelection_tibble &lt;- handle_publishedAt(election_tibble)\nhurricane_tibble &lt;- handle_publishedAt(hurricane_tibble)\n\nelection_tibble\n\n# A tibble: 100 × 10\n   sourceName               sourceId author   title description url   urlToImage\n   &lt;chr&gt;                    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;     \n 1 Biztoc.com               &lt;NA&gt;     news.go… Tesl… \"Tesla Bil… http… https://b…\n 2 Biztoc.com               &lt;NA&gt;     nbcnews… Stev… \"With less… http… https://b…\n 3 Freerepublic.com         &lt;NA&gt;     Washing… Whit… \"This week… http… &lt;NA&gt;      \n 4 Lawyersgunsmoneyblog.com &lt;NA&gt;     Paul Ca… Trum… \"Here’s a … http… https://m…\n 5 [Removed]                &lt;NA&gt;     &lt;NA&gt;     [Rem… \"[Removed]\" http… &lt;NA&gt;      \n 6 New York Post            &lt;NA&gt;     Charles… Jaso… \"Jason Tre… http… https://n…\n 7 Liveandletsfly.com       &lt;NA&gt;     Live an… Opin… \"Boeing la… http… https://l…\n 8 Freerepublic.com         &lt;NA&gt;     Powerli… WORL… \"Many of t… http… &lt;NA&gt;      \n 9 Freerepublic.com         &lt;NA&gt;     Fox 29(… Bomb… \"Pennsylva… http… &lt;NA&gt;      \n10 Raw Story                &lt;NA&gt;     Ariana … Anxi… \"WASHINGTO… http… https://w…\n# ℹ 90 more rows\n# ℹ 3 more variables: publishedAt &lt;dttm&gt;, content &lt;chr&gt;, pub_diff &lt;drtn&gt;\n\nhurricane_tibble\n\n# A tibble: 100 × 10\n   sourceName       sourceId author           title description url   urlToImage\n   &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;     \n 1 Inside the Magic &lt;NA&gt;     \"Chloe James\"    Yet … \"Another t… http… https://i…\n 2 Touringplans.com &lt;NA&gt;     \"Derek Burgan\"   Them… \"The Theme… http… https://b…\n 3 Newsweek         newsweek \"Jack Beresford\" Fami… \"Nancy Col… http… https://d…\n 4 Daily Signal     &lt;NA&gt;     \"Brandy Perez\"   Desp… \"At every … http… https://w…\n 5 Biztoc.com       &lt;NA&gt;     \"newsweek.com\"   Fami… \"A cat who… http… https://b…\n 6 Biztoc.com       &lt;NA&gt;     \"aol.com\"        This… \"James Gre… http… https://b…\n 7 NDTV News        &lt;NA&gt;      &lt;NA&gt;            NASA… \"Three cre… http… https://c…\n 8 Freerepublic.com &lt;NA&gt;     \"The Warhorse\"   Far-… \"Just as f… http… &lt;NA&gt;      \n 9 Forbes           &lt;NA&gt;     \"Kelly Phillips… Tax … \"Our lates… http… https://i…\n10 [Removed]        &lt;NA&gt;      &lt;NA&gt;            [Rem… \"[Removed]\" http… &lt;NA&gt;      \n# ℹ 90 more rows\n# ℹ 3 more variables: publishedAt &lt;dttm&gt;, content &lt;chr&gt;, pub_diff &lt;drtn&gt;\n\n\nAnalysis of publishedAt and pub_diff columns:\n\nget_date_metrics &lt;- function(tb){\n  \n  tb &lt;- select(tb, publishedAt, pub_diff)\n  \n  metrics &lt;- map(tb, \\(x) {return(list(mean=mean(x, na.rm=TRUE), sd=sd(x, na.rm=TRUE), median=median(x, na.rm=TRUE)))})\n  \n  return(metrics)\n  \n}\n\nget_date_metrics(election_tibble)\n\n$publishedAt\n$publishedAt$mean\n[1] \"2024-10-27 14:21:13 UTC\"\n\n$publishedAt$sd\n[1] 1628.46\n\n$publishedAt$median\n[1] \"2024-10-27 14:24:03 UTC\"\n\n\n$pub_diff\n$pub_diff$mean\nTime difference of 56.65657 secs\n\n$pub_diff$sd\n[1] 64.2354\n\n$pub_diff$median\nTime difference of 31 secs\n\nget_date_metrics(hurricane_tibble)\n\n$publishedAt\n$publishedAt$mean\n[1] \"2024-10-27 01:22:38 UTC\"\n\n$publishedAt$sd\n[1] 32480.57\n\n$publishedAt$median\n[1] \"2024-10-26 23:50:26 UTC\"\n\n\n$pub_diff\n$pub_diff$mean\nTime difference of 964.101 secs\n\n$pub_diff$sd\n[1] 1193.73\n\n$pub_diff$median\nTime difference of 601 secs"
  }
]